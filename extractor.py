import pickle
from Subjects import *
from Astronomy import Astronomy
import os

def extract_questions(trivia_dict):
    trivia_dict = trivia_dict['trivia']['questions']

    questions_list = []
    for question in trivia_dict:
        current_question = {Question.QUESTION_TEXT: question['question'], Question.OPTIONS_TEXT: []}
        for ans in question['answers']:
            current_question[Question.OPTIONS_TEXT].append(ans['answer'])
            if ans['correct']:
                current_question[Question.TRUE_ANSWER_TEXT] = ans['answer']

        questions_list.append(current_question)

    return questions_list

def append_questions(trivia_dict, file_path):
    new_questions = extract_questions(trivia_dict)

    file_questions = []
    if os.path.exists(file_path):
        with open(file_path, "rb") as f:
            file_questions = pickle.load(f)

    new_questions = new_questions + file_questions

    print(new_questions)

    with open(file_path, "wb") as f:
        pickle.dump(new_questions, f)



window = """{"id":227895,"user_id":null,"trivia_id":4737,"created_at":"2022-12-15T16:58:01.000000Z","updated_at":"2022-12-15T16:58:01.000000Z","hash_id":"9aLxVzYpNkMlOP6XNWLdJ8vrn5ob0GDA","trivia":{"id":4737,"user_id":null,"title":"Harry Potter - Hard","meta_title":null,"description":null,"difficulty":3,"is_public":true,"is_featured":true,"created_at":"2022-04-27T08:06:17.000000Z","updated_at":"2022-05-06T09:14:18.000000Z","questions":[{"id":71404,"trivia_id":4737,"question":"How old do you have to be to apparate?","order":null,"accuracy":null,"verified":null,"created_at":"2022-04-27T08:06:18.000000Z","updated_at":"2022-04-27T08:06:18.000000Z","answers":[{"id":285606,"question_id":71404,"answer":"17","correct":true},{"id":285613,"question_id":71404,"answer":"16","correct":false},{"id":285620,"question_id":71404,"answer":"15","correct":false},{"id":285627,"question_id":71404,"answer":"18","correct":false}]},{"id":71515,"trivia_id":4737,"question":"Which of the Weasley brothers followed their father into the Ministry of Magic?","order":null,"accuracy":null,"verified":null,"created_at":"2022-04-27T08:06:19.000000Z","updated_at":"2022-04-27T08:06:19.000000Z","answers":[{"id":286041,"question_id":71515,"answer":"Percy","correct":true},{"id":286050,"question_id":71515,"answer":"Bill","correct":false},{"id":286057,"question_id":71515,"answer":"Charlie","correct":false},{"id":286062,"question_id":71515,"answer":"George","correct":false}]},{"id":71506,"trivia_id":4737,"question":"What bodily part did George Weasley lose in the Deathly Hallows?","order":null,"accuracy":null,"verified":null,"created_at":"2022-04-27T08:06:18.000000Z","updated_at":"2022-04-27T08:06:18.000000Z","answers":[{"id":286000,"question_id":71506,"answer":"Ear","correct":true},{"id":286009,"question_id":71506,"answer":"Eye","correct":false},{"id":286015,"question_id":71506,"answer":"Finger","correct":false},{"id":286022,"question_id":71506,"answer":"Toe","correct":false}]},{"id":71496,"trivia_id":4737,"question":"What is the portent of death known as the Grim?","order":null,"accuracy":null,"verified":null,"created_at":"2022-04-27T08:06:18.000000Z","updated_at":"2022-04-27T08:06:18.000000Z","answers":[{"id":285960,"question_id":71496,"answer":"Dog","correct":true},{"id":285969,"question_id":71496,"answer":"Dragon","correct":false},{"id":285976,"question_id":71496,"answer":"Grim Reaper","correct":false},{"id":285981,"question_id":71496,"answer":"Basilisk","correct":false}]},{"id":71486,"trivia_id":4737,"question":"Who sticks their wand up the trolls nose?","order":null,"accuracy":null,"verified":null,"created_at":"2022-04-27T08:06:18.000000Z","updated_at":"2022-04-27T08:06:18.000000Z","answers":[{"id":285922,"question_id":71486,"answer":"Harry","correct":true},{"id":285931,"question_id":71486,"answer":"Ron","correct":false},{"id":285938,"question_id":71486,"answer":"Hermione","correct":false},{"id":285942,"question_id":71486,"answer":"Neville","correct":false}]},{"id":71475,"trivia_id":4737,"question":"How long was the wand that Mr. Ollivander sold to Hagrid when he starting at Hogwarts?","order":null,"accuracy":null,"verified":null,"created_at":"2022-04-27T08:06:18.000000Z","updated_at":"2022-04-27T08:06:18.000000Z","answers":[{"id":285879,"question_id":71475,"answer":"16","correct":true},{"id":285888,"question_id":71475,"answer":"15\/01\/2004","correct":false},{"id":285894,"question_id":71475,"answer":"13","correct":false},{"id":285901,"question_id":71475,"answer":"16\/01\/2002","correct":false}]},{"id":71465,"trivia_id":4737,"question":"What is the first name of Harry\u0027s nemesis Malfoy?","order":null,"accuracy":null,"verified":null,"created_at":"2022-04-27T08:06:18.000000Z","updated_at":"2022-04-27T08:06:18.000000Z","answers":[{"id":285838,"question_id":71465,"answer":"Draco","correct":true},{"id":285848,"question_id":71465,"answer":"Drago","correct":false},{"id":285857,"question_id":71465,"answer":"Drano","correct":false},{"id":285863,"question_id":71465,"answer":"Draso","correct":false}]},{"id":71456,"trivia_id":4737,"question":"How many copies did The Deathly Hallow sell in its first 24 hours?","order":null,"accuracy":null,"verified":null,"created_at":"2022-04-27T08:06:18.000000Z","updated_at":"2022-04-27T08:06:18.000000Z","answers":[{"id":285797,"question_id":71456,"answer":"15m","correct":true},{"id":285809,"question_id":71456,"answer":"12m","correct":false},{"id":285815,"question_id":71456,"answer":"14m","correct":false},{"id":285823,"question_id":71456,"answer":"16m","correct":false}]},{"id":71445,"trivia_id":4737,"question":"At the end of \u0027The Philosopher\u0027s Stone\u0027, how many housepoints did Slytherin have?","order":null,"accuracy":null,"verified":null,"created_at":"2022-04-27T08:06:18.000000Z","updated_at":"2022-04-27T08:06:18.000000Z","answers":[{"id":285764,"question_id":71445,"answer":"472","correct":true},{"id":285774,"question_id":71445,"answer":"462","correct":false},{"id":285778,"question_id":71445,"answer":"572","correct":false},{"id":285785,"question_id":71445,"answer":"562","correct":false}]},{"id":71436,"trivia_id":4737,"question":"Which of the following was one of Voldemort\u0027s horcruxes?","order":null,"accuracy":null,"verified":null,"created_at":"2022-04-27T08:06:18.000000Z","updated_at":"2022-04-27T08:06:18.000000Z","answers":[{"id":285727,"question_id":71436,"answer":"Harry","correct":true},{"id":285733,"question_id":71436,"answer":"Ron","correct":false},{"id":285737,"question_id":71436,"answer":"Hermione","correct":false},{"id":285744,"question_id":71436,"answer":"Hagrid","correct":false}]},{"id":71426,"trivia_id":4737,"question":"What was the first name of Ms Hufflepuff?","order":null,"accuracy":null,"verified":null,"created_at":"2022-04-27T08:06:18.000000Z","updated_at":"2022-04-27T08:06:18.000000Z","answers":[{"id":285688,"question_id":71426,"answer":"Helga","correct":true},{"id":285695,"question_id":71426,"answer":"Hilda","correct":false},{"id":285702,"question_id":71426,"answer":"Henrietta","correct":false},{"id":285709,"question_id":71426,"answer":"Harriet","correct":false}]},{"id":71415,"trivia_id":4737,"question":"In the 1991 break in at Gringotts Quirrell attempted to rob which vault?","order":null,"accuracy":null,"verified":null,"created_at":"2022-04-27T08:06:18.000000Z","updated_at":"2022-04-27T08:06:18.000000Z","answers":[{"id":285643,"question_id":71415,"answer":"713","correct":true},{"id":285653,"question_id":71415,"answer":"712","correct":false},{"id":285661,"question_id":71415,"answer":"714","correct":false},{"id":285667,"question_id":71415,"answer":"715","correct":false}]},{"id":71298,"trivia_id":4737,"question":"Who drove the Knight Bus during the early 1990\u0027s?","order":null,"accuracy":null,"verified":null,"created_at":"2022-04-27T08:06:17.000000Z","updated_at":"2022-04-27T08:06:17.000000Z","answers":[{"id":285168,"question_id":71298,"answer":"Ernie","correct":true},{"id":285176,"question_id":71298,"answer":"Stan","correct":false},{"id":285183,"question_id":71298,"answer":"Bert","correct":false},{"id":285191,"question_id":71298,"answer":"Doug","correct":false}]},{"id":71395,"trivia_id":4737,"question":"What is the name of Ron\u0027s mom?","order":null,"accuracy":null,"verified":null,"created_at":"2022-04-27T08:06:18.000000Z","updated_at":"2022-04-27T08:06:18.000000Z","answers":[{"id":285567,"question_id":71395,"answer":"Mo;y","correct":true},{"id":285573,"question_id":71395,"answer":"Millie","correct":false},{"id":285581,"question_id":71395,"answer":"Mary","correct":false},{"id":285589,"question_id":71395,"answer":"Maisie","correct":false}]},{"id":71385,"trivia_id":4737,"question":"How many staircases are there at Hogwarts?","order":null,"accuracy":null,"verified":null,"created_at":"2022-04-27T08:06:18.000000Z","updated_at":"2022-04-27T08:06:18.000000Z","answers":[{"id":285528,"question_id":71385,"answer":"142","correct":true},{"id":285534,"question_id":71385,"answer":"132","correct":false},{"id":285541,"question_id":71385,"answer":"152","correct":false},{"id":285548,"question_id":71385,"answer":"162","correct":false}]},{"id":71375,"trivia_id":4737,"question":"What was Harry\u0027s mom called?","order":null,"accuracy":null,"verified":null,"created_at":"2022-04-27T08:06:18.000000Z","updated_at":"2022-04-27T08:06:18.000000Z","answers":[{"id":285487,"question_id":71375,"answer":"Lily","correct":true},{"id":285494,"question_id":71375,"answer":"Rose","correct":false},{"id":285501,"question_id":71375,"answer":"Daisy","correct":false},{"id":285511,"question_id":71375,"answer":"Tulip","correct":false}]},{"id":71366,"trivia_id":4737,"question":"Aragog\u0027s wife is called what?","order":null,"accuracy":null,"verified":null,"created_at":"2022-04-27T08:06:18.000000Z","updated_at":"2022-04-27T08:06:18.000000Z","answers":[{"id":285445,"question_id":71366,"answer":"Mosag","correct":true},{"id":285449,"question_id":71366,"answer":"Masago","correct":false},{"id":285458,"question_id":71366,"answer":"Mohamma","correct":false},{"id":285467,"question_id":71366,"answer":"Masawi","correct":false}]},{"id":71356,"trivia_id":4737,"question":"A centaur has the body of what animal?","order":null,"accuracy":null,"verified":null,"created_at":"2022-04-27T08:06:18.000000Z","updated_at":"2022-04-27T08:06:18.000000Z","answers":[{"id":285411,"question_id":71356,"answer":"Horse","correct":true},{"id":285418,"question_id":71356,"answer":"Goat","correct":false},{"id":285422,"question_id":71356,"answer":"Stag","correct":false},{"id":285432,"question_id":71356,"answer":"Sheep","correct":false}]},{"id":71347,"trivia_id":4737,"question":"Hermiones birthday is what date in September?","order":null,"accuracy":null,"verified":null,"created_at":"2022-04-27T08:06:17.000000Z","updated_at":"2022-04-27T08:06:17.000000Z","answers":[{"id":285370,"question_id":71347,"answer":"19th","correct":true},{"id":285381,"question_id":71347,"answer":"18th","correct":false},{"id":285386,"question_id":71347,"answer":"17th","correct":false},{"id":285397,"question_id":71347,"answer":"20th","correct":false}]},{"id":71336,"trivia_id":4737,"question":"The Acromantula spider has how many eyes?","order":null,"accuracy":null,"verified":null,"created_at":"2022-04-27T08:06:17.000000Z","updated_at":"2022-04-27T08:06:17.000000Z","answers":[{"id":285331,"question_id":71336,"answer":"8","correct":true},{"id":285340,"question_id":71336,"answer":"7","correct":false},{"id":285350,"question_id":71336,"answer":"6","correct":false},{"id":285355,"question_id":71336,"answer":"9","correct":false}]},{"id":71328,"trivia_id":4737,"question":"In which year was the Knight Bus first commissioned?","order":null,"accuracy":null,"verified":null,"created_at":"2022-04-27T08:06:17.000000Z","updated_at":"2022-04-27T08:06:17.000000Z","answers":[{"id":285293,"question_id":71328,"answer":"1865","correct":true},{"id":285303,"question_id":71328,"answer":"1860","correct":false},{"id":285310,"question_id":71328,"answer":"1855","correct":false},{"id":285314,"question_id":71328,"answer":"1870","correct":false}]},{"id":71318,"trivia_id":4737,"question":"Seamus Finnegan\u0027s petronus is what?","order":null,"accuracy":null,"verified":null,"created_at":"2022-04-27T08:06:17.000000Z","updated_at":"2022-04-27T08:06:17.000000Z","answers":[{"id":285250,"question_id":71318,"answer":"A Fox","correct":true},{"id":285257,"question_id":71318,"answer":"An Owl","correct":false},{"id":285269,"question_id":71318,"answer":"A Turtle","correct":false},{"id":285275,"question_id":71318,"answer":"A Stoat","correct":false}]},{"id":71306,"trivia_id":4737,"question":"Voldemort was how many miles away when Harry woke up from his dream in the Goblet of Fire?","order":null,"accuracy":null,"verified":null,"created_at":"2022-04-27T08:06:17.000000Z","updated_at":"2022-04-27T08:06:17.000000Z","answers":[{"id":285207,"question_id":71306,"answer":"200","correct":true},{"id":285216,"question_id":71306,"answer":"180","correct":false},{"id":285224,"question_id":71306,"answer":"220","correct":false},{"id":285232,"question_id":71306,"answer":"160","correct":false}]}]},"answers":[]}"""
window = window.replace('null', 'None')
window = window.replace('false', 'False')
window = window.replace('true', 'True')
window = eval(window)

print(append_questions(window, 'Data\\.pkl'))
#print()
